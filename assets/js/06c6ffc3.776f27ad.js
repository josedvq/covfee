"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7],{3905:function(e,t,o){o.d(t,{Zo:function(){return s},kt:function(){return f}});var n=o(67294);function i(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){i(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,i=function(e,t){if(null==e)return{};var o,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||(i[o]=e[o]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)o=r[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(i[o]=e[o])}return i}var p=n.createContext({}),c=function(e){var t=n.useContext(p),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},s=function(e){var t=c(e.components);return n.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),u=c(o),f=i,m=u["".concat(p,".").concat(f)]||u[f]||d[f]||r;return o?n.createElement(m,a(a({ref:t},s),{},{components:o})):n.createElement(m,a({ref:t},s))}));function f(e,t){var o=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=o.length,a=new Array(r);a[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var c=2;c<r;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},97306:function(e,t,o){o.r(t),o.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return c},toc:function(){return s},default:function(){return u}});var n=o(87462),i=o(63366),r=(o(67294),o(3905)),a=["components"],l={title:"Deploying to a server"},p=void 0,c={unversionedId:"deployment",id:"deployment",title:"Deploying to a server",description:"Deploying covfee is necessary when you want to make your HITs available to others over the internet. We do not recommend developing your tasks in deployment mode. It is normally more convenient to create your HIT specifications locally, deploy covfee, and then run covfee make on the deployed instance to initialize your database.",source:"@site/docs/deployment.mdx",sourceDirName:".",slug:"/deployment",permalink:"/covfee/docs/deployment",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/docs/deployment.mdx",tags:[],version:"current",frontMatter:{title:"Deploying to a server"},sidebar:"docs",previous:{title:"Reading the output",permalink:"/covfee/docs/output"},next:{title:"Instructions",permalink:"/covfee/docs/tasks/instructions"}},s=[{value:"Deployment configuration",id:"deployment-configuration",children:[{value:"Basic configuration",id:"basic-configuration",children:[],level:3},{value:"Hosting media files externally",id:"hosting-media-files-externally",children:[],level:3}],level:2},{value:"Deployment options",id:"deployment-options",children:[{value:"gunicorn",id:"gunicorn",children:[],level:3},{value:"Apache mod_wsgi",id:"apache-mod_wsgi",children:[],level:3},{value:"More deployment options",id:"more-deployment-options",children:[],level:3}],level:2}],d={toc:s};function u(e){var t=e.components,o=(0,i.Z)(e,a);return(0,r.kt)("wrapper",(0,n.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Deploying covfee is necessary when you want to make your HITs available to others over the internet. We do not recommend developing your tasks in deployment mode. It is normally more convenient to create your HIT specifications locally, deploy covfee, and then run ",(0,r.kt)("inlineCode",{parentName:"p"},"covfee make")," on the deployed instance to initialize your database."),(0,r.kt)("h2",{id:"deployment-configuration"},"Deployment configuration"),(0,r.kt)("p",null,"covfee reads its configuration from the folder in which it is run (ie. the project folder). When ran in deployment mode, covfee will look for the file ",(0,r.kt)("inlineCode",{parentName:"p"},"covfee.deployment.config.py")," for its configuration. "),(0,r.kt)("h3",{id:"basic-configuration"},"Basic configuration"),(0,r.kt)("p",null,"If you are deploying covfee in a typical server, add a configuration file like the following to your project folder:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"BASE_URL = 'http://example.com/covfee'\nAPP_PORT = 80\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"BASE_URL")," option should point to the public URL of your covfee instance."),(0,r.kt)("h3",{id:"hosting-media-files-externally"},"Hosting media files externally"),(0,r.kt)("p",null,"To host media files externally, add the following to your ",(0,r.kt)("inlineCode",{parentName:"p"},"covfee.deployment.config.py"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEDIA_URL = 'http://example.com/covfee-media'\nMEDIA_SERVER = False\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"MEDIA_URL")," option allows you to customize the location of your media files. By default, covfee will serve media files from a folder called ",(0,r.kt)("inlineCode",{parentName:"p"},"media")," in your project folder. Anything in this folder will be made public. If you want to host your media files externally, you can disable this behavior by setting ",(0,r.kt)("inlineCode",{parentName:"p"},"MEDIA_SERVER")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"False")," and pointing ",(0,r.kt)("inlineCode",{parentName:"p"},"MEDIA_URL")," to your files' location."),(0,r.kt)("h2",{id:"deployment-options"},"Deployment options"),(0,r.kt)("h3",{id:"gunicorn"},"gunicorn"),(0,r.kt)("p",null,"gunicorn is the most common deployment option for Flask applications. To run a production copy of covfee on your covfee project directory:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install covfee per the Getting Started instructions. It is recommended to install covfee in a virtual environment.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Build covfee. This will build the Javascript bundle used by the covfee app."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"cd /path/to/covfee-project\ncovfee-build\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Run the covfee server:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"covfee-gunicorn\n")),(0,r.kt)("h3",{id:"apache-mod_wsgi"},"Apache mod_wsgi"),(0,r.kt)("p",null,"covfee can be run under Apache by using ",(0,r.kt)("a",{parentName:"p",href:"https://modwsgi.readthedocs.io/en/master/"},"mod_wsgi"),". ",(0,r.kt)("inlineCode",{parentName:"p"},"mod_wsgi")," must be installed for Python 3 for covfee to work. To ensure this install:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt-get install libapache2-mod-wsgi-py3\n")),(0,r.kt)("p",null,"Next, add a file ",(0,r.kt)("inlineCode",{parentName:"p"},"covfee.wsgi")," with the following to your project directory:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"import sys\nimport os\nsys.stdout = sys.stderr\nactivate_this = '/path/to/virtualenv/bin/activate_this.py'\nwith open(activate_this) as file_:\n    exec(file_.read(), dict(__file__=activate_this))\nos.chdir('/path/to/covfee-project')\nfrom covfee.start import create_app\napplication = create_app()\n")),(0,r.kt)("p",null,"This code will allow Apache to create your app instance. ",(0,r.kt)("inlineCode",{parentName:"p"},"/path/to/virtualenv")," is the path to your virtual environment where covfee is installed."),(0,r.kt)("p",null,"Finally, Apache must know about your site. For this add lines like the following to your apache site configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"WSGIDaemonProcess covfee user=me group=me threads=3\nWSGIProcessGroup covfee\nWSGIScriptAlias /covfee /path/to/covfee-project/covfee.wsgi\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"WSGIScriptAlias")," must point to the ",(0,r.kt)("inlineCode",{parentName:"p"},"covfee.wsgi")," file you created in the previous step. The first parameter ",(0,r.kt)("inlineCode",{parentName:"p"},"/covfee")," is the url path under which covfee will be accesible. "),(0,r.kt)("h3",{id:"more-deployment-options"},"More deployment options"),(0,r.kt)("p",null,"Covfee is built with Flask and is therefore easy to deploy using any of the options supported by Flask. Take a look at the ",(0,r.kt)("a",{parentName:"p",href:"https://flask.palletsprojects.com/en/1.1.x/deploying/"},"Flask deployment options")," for more."))}u.isMDXComponent=!0}}]);