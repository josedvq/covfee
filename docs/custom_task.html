<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.10">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/gh/josedvq/covfee@8050fa938ae270ae70244c33903ead9d905bca92/covfee/static/js/opencv.js"></script><title data-react-helmet="true">Developing custom tasks | covfee: continuous video feedback tool</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/covfee/docs/custom_task"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Developing custom tasks | covfee: continuous video feedback tool"><meta data-react-helmet="true" name="description" content="New custom tasks or HIT types can be added by implementing a React component meeting a few conditions. For some tasks, a Python base class must be sub-classed too. To be valid, task components must meet these conditions:"><meta data-react-helmet="true" property="og:description" content="New custom tasks or HIT types can be added by implementing a React component meeting a few conditions. For some tasks, a Python base class must be sub-classed too. To be valid, task components must meet these conditions:"><link data-react-helmet="true" rel="icon" href="/covfee/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/covfee/docs/custom_task" hreflang="x-default"><link rel="stylesheet" href="/covfee/assets/css/styles.e47ef7b4.css">
<link rel="preload" href="/covfee/assets/js/runtime~main.6ab5080b.js" as="script">
<link rel="preload" href="/covfee/assets/js/main.a5f528e3.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><div class="announcementBar_axC9" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_xYHE"></div><div class="announcementBarContent_6uhP"><a href="https://github.com/josedvq/covfee">⭐ If you like covfee, give it a star on GitHub!</a></div><button type="button" class="clean-btn close announcementBarClose_A3A1" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/covfee/"><div class="navbar__logo"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/covfee/img/logo.svg" alt="covfee logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">covfee</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/covfee/docs">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/josedvq/covfee" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs/getting_started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs/entities">HITs, Journeys and Tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs/timers">Task Lifecycle and Timers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/covfee/docs/deployment">Deploying to a server</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/covfee/docs/development">Advanced</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/development">Development install</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/covfee/docs/custom_task">Developing custom tasks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/architecture">Architecture</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/covfee/docs/tasks/openvimo">Tasks</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/covfee/docs/tasks/openvimo">OpenVIMO video calling</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Developing custom tasks</h1></header><p>New custom tasks or HIT types can be added by implementing a React component meeting a few conditions. For some tasks, a Python base class must be sub-classed too. To be valid, task components must meet these conditions:</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="types-of-tasks">Types of tasks<a aria-hidden="true" class="hash-link" href="#types-of-tasks" title="Direct link to heading">​</a></h2><p>There are two main types of tasks in covfee:</p><ul><li>Tasks with shared state, or <em>multiplayer</em> tasks are meant to be visited by multiple users at the same time. A chess game, or a collaborative live view form to be filled by multiple users at the same time is an example of a shared state task. Covfee internally manages state synchronization and persistence. A copy of the latest state is kept in the server. If the task is opened in multiple clients (windows/tabs), they will all be kept in sync and changes can be observed <em>live</em>.</li><li>Tasks without shared state, or &quot;single player&quot; tasks are meant to be visited by a single user. A standard form is a good example. If these tasks are opened in multiple clients (windows/tabs) they will not be kept in sync. Their state will diverge when multiple users make changes.</li></ul><h2 class="anchor anchorWithStickyNavbar_y2LR" id="task-state">Task state<a aria-hidden="true" class="hash-link" href="#task-state" title="Direct link to heading">​</a></h2><p>Covfee tasks are, in their most basic form, simply React components. In other words, copy-pasting any React component as a Covfee task would &quot;work&quot;. However, in any type of online experiment we normally want to store the results of the task (eg. the answers to a questionnaire).</p><p>In covfee, task components do not explicitly store or commit these results to the server. Instead, the state of the task is stored automatically by Covfee. To make use of this, any task state that should be persisted by Covfee must be managed in a central Redux store. In other words, <strong>implementing Covfee tasks boils down to implementing React components with a Redux state store</strong> in all cases. This means following the Redux design phylosophy by defining actions and reducers, which produce a new state given an action and the current state:</p><div style="text-align:center"><img src="/covfee/img/redux.png" style="width:50%;max-width:500px;text-align:center"></div><p>The React component&#x27;s (Interface / view) job is simply to update the DOM according to the current state, and to dispatch actions in response to browser events.</p><p>State persistance and loading is managed internally by Covfee:</p><ul><li><p>For shared state tasks, Covfee will keep the most up-to-date state in the server, which will always represent the latest state of the task.</p></li><li><p>For non-shared state tasks, the latest state is kept in the browser and persisted when necessary. Covfee submits and persists state whenever:</p><ul><li>When a certain time has passed after the last state change. The default is 3s.</li><li>The user moves to the next or previous task or otherwise leaves the task. An exception is if the user abruptly closes the browser window/tab where the task is open. In this case the state may not sent to the server.</li><li>The user presses the &quot;submit&quot; button in the task.</li></ul></li></ul><p>State that does not need to be stored can be managed separately, for example using React&#x27;s <code>useState</code>.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="tutorial-developing-your-own-task">Tutorial: developing your own task<a aria-hidden="true" class="hash-link" href="#tutorial-developing-your-own-task" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="background">Background<a aria-hidden="true" class="hash-link" href="#background" title="Direct link to heading">​</a></h3><p>This tutorial requires a basic understanding of Typescript, HTML, React and Redux. For progressing to more complex custom tasks the following is recommended:</p><ul><li>Typescript, Javascript, HTML, CSS. For more complex tasks, a good level of CSS might be necessary.</li><li>React: functional components, hooks (useState, useEffect, useContext, useRef, useMemo), custom hooks, fetching data. It&#x27;s important to understand the nuances behind hooks and dependencies: when do hooks run?</li><li>Redux, Redux toolkit. Important to understand how to think about application state and how to design the state, actions and reducers:</li></ul><p>In general, <strong>you should know how to design and write a React application using Redux for state management</strong>.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="installation">Installation<a aria-hidden="true" class="hash-link" href="#installation" title="Direct link to heading">​</a></h3><p>Please start by following the <a href="/covfee/docs/development">development install instructions</a> to install Covfee.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-tutorial">The tutorial<a aria-hidden="true" class="hash-link" href="#the-tutorial" title="Direct link to heading">​</a></h3><p>In this tutorial, we will create a simple contact form asking users for their name and email. Additionally, the task will have one boolean prop (<code>showPhoneField</code>) that, if true, will add a phone number field to the form. The answers to the form will be preserved in task state.</p><p>We will place Typescript files for the task in <code>covfee/client/tasks</code>, in the following structure:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">covfee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tasks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - my_task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - index.tsx       # the main React component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - slice.ts        # the state specification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                - spec.ts         # the props for the task</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...               # any extra files needed</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="task-props">Task props<a aria-hidden="true" class="hash-link" href="#task-props" title="Direct link to heading">​</a></h3><p>First, we place the specification for the task props in the <code>spec.ts</code> file:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import { BaseTaskSpec } from &quot;@covfee-shared/spec/task&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @TJS-additionalProperties false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export interface TutorialTaskSpec extends BaseTaskSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * @default &quot;TutorialTask&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  type: &quot;TutorialTask&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   * Media file to be displayed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  showPhoneField?: boolean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>These props will be parsed by Covfee so that they can be provided in Python when the task is created. They allow the user to configure the way a task is rendered to the user. In this case, we only provide two props. One is the name of the task. This will be the name of the task&#x27;s Python class and is a constant value. The other one is our only true prop <code>showPhoneField</code>, which we define to be boolean. The comments provided here will be parsed and will be available in Python when creating task objects. The line <code>TJS-additionalProperties false</code> specifies that no additional properties should be allowed when the task is validated.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="state">State<a aria-hidden="true" class="hash-link" href="#state" title="Direct link to heading">​</a></h3><p>Tasks in covfee specify their state by creating a Redux Toolkit slice. For our purposes a slice is just an object that encapsulates the initial state and the reducers for the task. In this case, we need the state to hold the user&#x27;s name, email and phone number. Our <code>slice.ts</code> file looks like this:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import { createSlice } from &quot;@reduxjs/toolkit&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export interface State {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  phone: string</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const initialState: State = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  email: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  phone: &quot;&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const slice = createSlice({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: &quot;form&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  initialState,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  reducers: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setName: (state, action) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.name = action.payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setEmail: (state, action) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.email = action.payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setPhone: (state, action) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      state.phone = action.payload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const { actions, reducer } = slice</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we specified the type for the state, the initial state, and wrote separate reducers to set name, email and phone number.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="react-component">React Component<a aria-hidden="true" class="hash-link" href="#react-component" title="Direct link to heading">​</a></h3><p>Following React + Redux design philosophy, the main job of the React component is to sync state with the DOM (view), by reading the state and by calling Redux actions in response to user events. In this case we read the state variables using <code>useSelector</code> in the same way it is used in Redux, and we call Redux actions whenever the content of the input elements changes. That&#x27;s all!</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">import React from &quot;react&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { slice, actions, State } from &quot;./slice&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { TaskExport } from &quot;../../types/node&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { CovfeeTaskProps } from &quot;../base&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import type { TutorialTaskSpec } from &quot;./spec&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { AllPropsRequired } from &quot;../../types/utils&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { useDispatch } from &quot;../../journey/state&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import { useSelector } from &quot;react-redux&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">interface Props extends CovfeeTaskProps&lt;TutorialTaskSpec&gt; {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const TutorialTask: React.FC&lt;Props&gt; = (props) =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // here we set the defaults for the task props</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // we could use useMemo to avoid recomputing on every render</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const args: AllPropsRequired&lt;Props&gt; = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...props,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    spec: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      showPhoneField: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ...props.spec,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // we read the state using useSelector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const name = useSelector&lt;State, string&gt;((state) =&gt; state.name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const email = useSelector&lt;State, string&gt;((state) =&gt; state.email)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const phoneNumber = useSelector&lt;State, string&gt;((state) =&gt; state.phone)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // this is a custom dispatch function provided by Covfee</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const dispatch = useDispatch()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // and we render the component</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;label htmlFor=&quot;name&quot;&gt;Name:&lt;/label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type=&quot;text&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          id=&quot;name&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value={name}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onChange={(e) =&gt; dispatch(actions.setName(e.target.value))}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;label htmlFor=&quot;email&quot;&gt;Email:&lt;/label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type=&quot;email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          id=&quot;email&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          value={email}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          onChange={(e) =&gt; dispatch(actions.setEmail(e.target.value))}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {args.spec.showPhoneField &amp;&amp; (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;label htmlFor=&quot;phone&quot;&gt;Phone:&lt;/label&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            type=&quot;tel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            id=&quot;phone&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value={phoneNumber}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            onChange={(e) =&gt; dispatch(actions.setPhone(e.target.value))}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          /&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/div&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      )}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;/form&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export default {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  taskComponent: TutorialTask,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  taskSlice: slice,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  useSharedState: false,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} as TaskExport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Note the <em>export</em> statement at the end of the file. Covfee expects every task to export a default object with these keys. <code>useSharedState</code> should only be set to true for <em>multiplayer</em> tasks.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="importing-the-task">Importing the task<a aria-hidden="true" class="hash-link" href="#importing-the-task" title="Direct link to heading">​</a></h3><p>Now that the task is created, the task should be imported into Covfee source files. To do this, modify the file at <code>/covfee/client/tasks/index.ts</code> to import your custom task. Simply follow the same pattern as for the rest of the imports in the file. The task props specification (<em>spec</em>) should also be imported in <code>/covfee/shared/spec/task.ts</code>.</p><p>Now we are ready to create the auto-generated code that Covfee is designed to create. Covfee auto-generates two files using the tasks&#x27; props specification:</p><ul><li>/covfee/shared/schemata.json - JSON schemata. Each task props specification (spec) is translated into a JSON schema, used for validation and for generating the dataclasses.</li><li>/covfee/shared/task_dataclasses.py contains the dataclasses that can be used to create task objects in Python. These are simple objects that take the task props as constructor arguments. Covfee internally translates them into database entries to initialize its database on startup.</li></ul><p>These files may be useful for debugging purposes to eg. make sure that the dataclasses have the right arguments, types and comments.</p><p>To (re-)create both of these auto-generated files run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">covfee-dev schemata</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this step, it should be possible to manually verify that the dataclasses file contains a new class for our custom task.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="running-the-task">Running the task<a aria-hidden="true" class="hash-link" href="#running-the-task" title="Direct link to heading">​</a></h2><p>The task is ready to be used. To do this in a dev environment, create a folder for the covfee project. This folder may be anywhere in the file system. The we will create the following structure:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">my_folder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - tutorial.py</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The naming is not relevant. Paste the following into the <code>tutorial.py</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">from covfee import tasks, HIT, Project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from covfee.config import config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from covfee.shared.dataclass import CovfeeApp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.load_environment(&quot;local&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my_task_1 = tasks.TutorialTaskSpec(name=&quot;My Task 1&quot;, showPhoneField=True)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">my_task_2 = tasks.TutorialTaskSpec(name=&quot;My Task 2&quot;, showPhoneField=False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hit = HIT(&quot;Joint counter&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">j1 = hit.add_journey(nodes=[my_task_1, my_task_2])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">projects = [Project(&quot;My Project&quot;, email=&quot;example@example.com&quot;, hits=[hit])]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app = CovfeeApp(projects)   # we must always create an app object of class CovfeeApp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Here we import the necessary classes, create two task objects using the same (auto-generated) <code>TutorialTaskSpec</code> class, and link them together in a journey. We create a HIT with a single journey, and a project with a single HIT. Finally, we create the <code>app</code> object. Covfee internally looks for this object by name (important that it is called <code>app</code>) and uses it as starting point to read the specification.</p><p>We can now start covfee with:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">covfee make tutorial.py --force --dev</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This will parse the specification, create the database, and start the covfee server.</p><p>In development mode, we need to run the webpack server separately. To do it, in another terminal run:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">covfee webpack</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>After this the Covfee admin panel should be accessible in the URL displayed when running the Covfee server (http://localhost:5000/admin# by default). The links to the Journey (with the two tasks) should be available in the admin panel (under <em>Journeys</em>).</p><p>With this development setup, any changes to the client or server will be hot-reloaded. Therefore it should be possible and convenient to edit the task&#x27;s React component or the backend while running the app.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/custom_task.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/covfee/docs/development"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->Development install</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/covfee/docs/architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture<!-- --> »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types-of-tasks" class="table-of-contents__link toc-highlight">Types of tasks</a></li><li><a href="#task-state" class="table-of-contents__link toc-highlight">Task state</a></li><li><a href="#tutorial-developing-your-own-task" class="table-of-contents__link toc-highlight">Tutorial: developing your own task</a><ul><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li><li><a href="#the-tutorial" class="table-of-contents__link toc-highlight">The tutorial</a></li><li><a href="#task-props" class="table-of-contents__link toc-highlight">Task props</a></li><li><a href="#state" class="table-of-contents__link toc-highlight">State</a></li><li><a href="#react-component" class="table-of-contents__link toc-highlight">React Component</a></li><li><a href="#importing-the-task" class="table-of-contents__link toc-highlight">Importing the task</a></li></ul></li><li><a href="#running-the-task" class="table-of-contents__link toc-highlight">Running the task</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/covfee/docs">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/josedvq" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/josedvq/covfee" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Jose Vargas. Docs built with Docusaurus.</div></div></div></footer></div>
<script src="/covfee/assets/js/runtime~main.6ab5080b.js"></script>
<script src="/covfee/assets/js/main.a5f528e3.js"></script>
</body>
</html>